<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VFD History Data Generator</title>
    <style>
        :root {
            --primary-dark: #1a1a1a;
            --secondary-dark: #2d2d2d;
            --tertiary-dark: #3d3d3d;
            --primary-yellow: #ffd700;
            --text-light: #f5f5f5;
            --text-gray: #aaaaaa;
            --success: #00c851;
            --warning: #ffbb33;
            --danger: #ff4444;
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-dark);
            color: var(--text-light);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--secondary-dark);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-yellow);
        }

        h1 {
            color: var(--primary-yellow);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-gray);
            font-size: 16px;
        }

        .card {
            background: var(--secondary-dark);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-yellow);
        }

        .card h2 {
            color: var(--primary-yellow);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-light);
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #555;
            background: var(--tertiary-dark);
            color: var(--text-light);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-yellow);
        }

        .file-input-container {
            position: relative;
            margin-bottom: 15px;
        }

        .file-input {
            width: 100%;
            padding: 10px;
            border: 2px dashed #555;
            border-radius: 4px;
            background: var(--tertiary-dark);
            color: var(--text-light);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-input:hover, .file-input.drag-over {
            border-color: var(--primary-yellow);
            background: rgba(255, 215, 0, 0.05);
        }

        .file-input input {
            display: none;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .btn-primary {
            background: var(--primary-yellow);
            color: var(--primary-dark);
        }

        .btn-primary:hover {
            background: #ffc400;
        }

        .btn-secondary {
            background: var(--tertiary-dark);
            color: var(--text-light);
            border: 1px solid #555;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .output-container {
            margin-top: 20px;
            position: relative;
        }

        #output {
            width: 100%;
            height: 400px;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #555;
            background: var(--tertiary-dark);
            color: var(--text-light);
            font-family: monospace;
            resize: vertical;
            white-space: pre;
            overflow: auto;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--secondary-dark);
            color: var(--text-light);
            border: 1px solid #555;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            background: #444;
        }

        .status {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }

        .status.success {
            background: rgba(0, 200, 81, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
            display: block;
        }

        .status.warning {
            background: rgba(255, 187, 51, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
            display: block;
        }

        .status.error {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
            display: block;
        }

        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .section-card {
            background: var(--tertiary-dark);
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid #444;
        }

        .section-card:hover {
            border-color: var(--primary-yellow);
        }

        .section-card.active {
            border-color: var(--primary-yellow);
            background: rgba(255, 215, 0, 0.1);
        }

        .section-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-yellow);
        }

        .section-stats {
            font-size: 12px;
            color: var(--text-gray);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .checkbox-group input {
            width: auto;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--tertiary-dark);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-yellow);
            width: 0%;
            transition: width 0.3s ease;
        }

        .data-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: var(--tertiary-dark);
            padding: 10px 15px;
            border-radius: 4px;
            border-left: 3px solid var(--primary-yellow);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-gray);
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-yellow);
        }

        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: var(--tertiary-dark);
            border-radius: 4px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            font-weight: bold;
            color: var(--primary-yellow);
        }

        .file-size {
            color: var(--text-gray);
            font-size: 14px;
        }

        .equipment-list {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            background: var(--secondary-dark);
            display: none;
        }

        .equipment-list.show {
            display: block;
        }

        .equipment-item {
            padding: 5px 0;
            border-bottom: 1px solid #333;
            font-size: 12px;
            color: var(--text-gray);
        }

        .equipment-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .sections-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>VFD History Data Generator</h1>
            <p class="subtitle">Generate realistic historical data for all equipment in your SCADA system</p>
        </header>

        <div class="card">
            <h2>SCADA Data Input</h2>
            
            <div class="file-input-container">
                <div class="file-input" id="fileDropArea">
                    <input type="file" id="fileInput" accept=".json">
                    <div>
                        <p>Drag & drop your SCADA data JSON file here</p>
                        <p>or click to browse</p>
                        <p><small>Supports files up to 50MB</small></p>
                    </div>
                </div>
            </div>
            
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName">No file selected</div>
                <div class="file-size" id="fileSize">-</div>
            </div>

            <div class="form-group">
                <label class="form-label">Date Range</label>
                <div style="display: flex; gap: 10px;">
                    <input type="date" id="startDate" class="form-control">
                    <input type="date" id="endDate" class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Data Points Per Day</label>
                <input type="number" id="dataPoints" class="form-control" value="6" min="1" max="24">
            </div>

            <div class="form-group">
                <label class="form-label">Sections to Include</label>
                <div class="sections-grid" id="sectionsContainer">
                    <div class="section-card" style="text-align: center; cursor: default;">
                        <p>Load a SCADA data file to see sections</p>
                    </div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="selectAllSections" checked disabled>
                    <label for="selectAllSections">Select All Sections</label>
                </div>
            </div>

            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="actions">
                <button id="generateBtn" class="btn btn-primary" disabled>
                    Generate VFD History
                </button>
                <button id="downloadBtn" class="btn btn-secondary" disabled>
                    Download JSON
                </button>
                <button id="clearBtn" class="btn btn-secondary">
                    Clear All
                </button>
            </div>

            <div id="status" class="status"></div>
        </div>

        <div class="card">
            <h2>Generated VFD History Data</h2>
            
            <div class="data-stats" id="dataStats" style="display: none;">
                <div class="stat-item">
                    <div class="stat-label">Sections</div>
                    <div class="stat-value" id="statSections">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Equipment</div>
                    <div class="stat-value" id="statEquipment">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Data Points</div>
                    <div class="stat-value" id="statDataPoints">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">File Size</div>
                    <div class="stat-value" id="statFileSize">0 KB</div>
                </div>
            </div>
            
            <div class="output-container">
                <button id="copyBtn" class="copy-btn" disabled>
                    Copy
                </button>
                <textarea id="output" readonly placeholder="Generated VFD history data will appear here..."></textarea>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const fileDropArea = document.getElementById('fileDropArea');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const dataPointsInput = document.getElementById('dataPoints');
        const sectionsContainer = document.getElementById('sectionsContainer');
        const selectAllCheckbox = document.getElementById('selectAllSections');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const clearBtn = document.getElementById('clearBtn');
        const copyBtn = document.getElementById('copyBtn');
        const outputTextarea = document.getElementById('output');
        const statusDiv = document.getElementById('status');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const dataStats = document.getElementById('dataStats');
        const statSections = document.getElementById('statSections');
        const statEquipment = document.getElementById('statEquipment');
        const statDataPoints = document.getElementById('statDataPoints');
        const statFileSize = document.getElementById('statFileSize');

        // Set default dates (last 7 days)
        const endDate = new Date();
        const startDate = new Date();
        startDate.setDate(startDate.getDate() - 7);
        
        startDateInput.value = startDate.toISOString().split('T')[0];
        endDateInput.value = endDate.toISOString().split('T')[0];

        // SCADA data
        let scadaData = null;
        let generatedData = null;

        // File drag and drop functionality
        fileDropArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', handleFileSelect);

        // Drag and drop events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileDropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            fileDropArea.addEventListener(eventName, () => {
                fileDropArea.classList.add('drag-over');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileDropArea.addEventListener(eventName, () => {
                fileDropArea.classList.remove('drag-over');
            }, false);
        });

        fileDropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length) {
                fileInput.files = files;
                handleFileSelect();
            }
        }

        // Handle file selection
        function handleFileSelect() {
            const file = fileInput.files[0];
            if (!file) return;
            
            // Check if file is JSON
            if (!file.name.toLowerCase().endsWith('.json')) {
                showStatus('Please select a JSON file', 'error');
                return;
            }
            
            // Check file size (limit to 50MB)
            if (file.size > 50 * 1024 * 1024) {
                showStatus('File is too large. Please select a file smaller than 50MB.', 'error');
                return;
            }
            
            // Update file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.classList.add('show');
            
            // Read and parse the file
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    scadaData = JSON.parse(e.target.result);
                    populateSections();
                    
                    showStatus(`Successfully loaded SCADA data with ${scadaData.sections.length} sections`, 'success');
                    generateBtn.disabled = false;
                    selectAllCheckbox.disabled = false;
                } catch (error) {
                    showStatus('Error parsing JSON file: ' + error.message, 'error');
                    console.error('Error parsing JSON:', error);
                }
            };
            
            reader.onerror = function() {
                showStatus('Error reading file', 'error');
            };
            
            reader.readAsText(file);
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        // Populate sections checkboxes
        function populateSections() {
            if (!scadaData || !scadaData.sections) return;
            
            sectionsContainer.innerHTML = '';
            
            scadaData.sections.forEach(section => {
                const sectionCard = document.createElement('div');
                sectionCard.className = 'section-card active';
                
                // Create equipment list HTML
                let equipmentListHTML = '';
                section.equipment.forEach(equipment => {
                    equipmentListHTML += `<div class="equipment-item">${equipment.equipment_id}</div>`;
                });
                
                sectionCard.innerHTML = `
                    <div class="section-name">${section.name}</div>
                    <div class="section-stats">${section.equipment.length} equipment, ${section.unique_models} models</div>
                    <div class="equipment-list">${equipmentListHTML}</div>
                    <input type="checkbox" class="section-checkbox" data-section="${section.name}" checked style="display: none;">
                `;
                
                sectionCard.addEventListener('click', (e) => {
                    // Don't toggle if clicking on equipment list
                    if (!e.target.closest('.equipment-list')) {
                        sectionCard.classList.toggle('active');
                        const checkbox = sectionCard.querySelector('.section-checkbox');
                        checkbox.checked = sectionCard.classList.contains('active');
                    }
                });
                
                // Show equipment list on hover
                sectionCard.addEventListener('mouseenter', () => {
                    const equipmentList = sectionCard.querySelector('.equipment-list');
                    equipmentList.classList.add('show');
                });
                
                sectionCard.addEventListener('mouseleave', () => {
                    const equipmentList = sectionCard.querySelector('.equipment-list');
                    equipmentList.classList.remove('show');
                });
                
                sectionsContainer.appendChild(sectionCard);
            });
            
            selectAllCheckbox.checked = true;
        }

        // Select/Deselect all sections
        selectAllCheckbox.addEventListener('change', () => {
            const sectionCards = document.querySelectorAll('.section-card');
            const checkboxes = document.querySelectorAll('.section-checkbox');
            
            sectionCards.forEach(card => {
                if (selectAllCheckbox.checked) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });

        // Generate VFD history data
        generateBtn.addEventListener('click', () => {
            if (!scadaData) {
                showStatus('Please load SCADA data first', 'error');
                return;
            }
            
            try {
                showStatus('Generating VFD history data for all equipment...', 'warning');
                progressBar.style.display = 'block';
                progressFill.style.width = '0%';
                
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);
                const dataPoints = parseInt(dataPointsInput.value);
                
                if (startDate > endDate) {
                    throw new Error('Start date cannot be after end date');
                }
                
                // Get selected sections
                const selectedSections = [];
                document.querySelectorAll('.section-checkbox:checked').forEach(checkbox => {
                    selectedSections.push(checkbox.getAttribute('data-section'));
                });
                
                if (selectedSections.length === 0) {
                    throw new Error('Please select at least one section');
                }
                
                // Generate data with progress updates
                generateVFDHistoryWithProgress(scadaData, selectedSections, startDate, endDate, dataPoints);
                
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                console.error('Error generating VFD history:', error);
            }
        });

        // Generate VFD history with progress updates
        function generateVFDHistoryWithProgress(scadaData, selectedSections, startDate, endDate, dataPointsPerDay) {
            const vfdHistory = {
                vfd_history: {
                    sections: {},
                    section_power_peaks: {}
                }
            };
            
            // Calculate days between dates
            const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            
            let totalEquipment = 0;
            let processedEquipment = 0;
            
            // Count total equipment for progress calculation
            selectedSections.forEach(sectionName => {
                const section = scadaData.sections.find(s => s.name === sectionName);
                if (section) {
                    totalEquipment += section.equipment.length;
                }
            });
            
            // Generate data for each selected section
            selectedSections.forEach(sectionName => {
                const section = scadaData.sections.find(s => s.name === sectionName);
                if (!section) return;
                
                vfdHistory.vfd_history.sections[sectionName] = {};
                vfdHistory.vfd_history.section_power_peaks[sectionName] = [];
                
                let totalSectionPower = 0;
                
                // Generate data for each equipment in the section
                section.equipment.forEach(equipment => {
                    const equipmentId = equipment.equipment_id;
                    vfdHistory.vfd_history.sections[sectionName][equipmentId] = {
                        running_time: [],
                        power_consumption: [],
                        frequency_history: []
                    };
                    
                    // Generate running time and power consumption data (daily for the date range)
                    for (let i = 0; i <= daysDiff; i++) {
                        const currentDate = new Date(startDate);
                        currentDate.setDate(startDate.getDate() + i);
                        const dateStr = currentDate.toISOString().split('T')[0];
                        
                        // Generate realistic running time (8-16 hours)
                        const runningTime = 8 + Math.random() * 8;
                        vfdHistory.vfd_history.sections[sectionName][equipmentId].running_time.push({
                            date: dateStr,
                            hours: parseFloat(runningTime.toFixed(1))
                        });
                        
                        // Generate power consumption based on power rating
                        let powerRating = parseFloat(equipment.power_rating) || 30;
                        if (isNaN(powerRating)) powerRating = 30;
                        
                        const powerConsumption = powerRating * runningTime * (0.7 + Math.random() * 0.3);
                        vfdHistory.vfd_history.sections[sectionName][equipmentId].power_consumption.push({
                            date: dateStr,
                            kwh: Math.round(powerConsumption)
                        });
                        
                        totalSectionPower += powerConsumption;
                        
                        // Generate frequency history for this day
                        for (let j = 0; j < dataPointsPerDay; j++) {
                            const hour = Math.floor((j * 24) / dataPointsPerDay);
                            const minute = Math.floor(((j * 24) % dataPointsPerDay) * (60 / dataPointsPerDay));
                            
                            const timestamp = `${dateStr} ${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                            
                            // Generate realistic frequency data (40-60 Hz with some variation)
                            let baseFrequency = 50;
                            if (equipment.power_rating && parseFloat(equipment.power_rating) > 40) {
                                baseFrequency = 55 + Math.random() * 5;
                            } else {
                                baseFrequency = 45 + Math.random() * 10;
                            }
                            
                            const frequency = baseFrequency + (Math.random() - 0.5) * 4;
                            
                            vfdHistory.vfd_history.sections[sectionName][equipmentId].frequency_history.push({
                                timestamp: timestamp,
                                frequency: parseFloat(frequency.toFixed(1))
                            });
                        }
                    }
                    
                    // Update progress
                    processedEquipment++;
                    const progress = (processedEquipment / totalEquipment) * 100;
                    progressFill.style.width = `${progress}%`;
                });
                
                // Generate section power peaks (daily totals)
                for (let i = 0; i <= daysDiff; i++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + i);
                    const dateStr = currentDate.toISOString().split('T')[0];
                    
                    // Calculate peak power for the section (total power with some variation)
                    const peakPower = totalSectionPower * (0.8 + Math.random() * 0.4) / (daysDiff + 1);
                    
                    vfdHistory.vfd_history.section_power_peaks[sectionName].push({
                        date: dateStr,
                        peak_kwh: Math.round(peakPower)
                    });
                }
            });
            
            // Store generated data
            generatedData = vfdHistory;
            
            // Update UI with results
            updateResultsUI(vfdHistory, selectedSections, daysDiff, dataPointsPerDay);
        }

        // Update UI with generation results
        function updateResultsUI(vfdHistory, selectedSections, daysDiff, dataPointsPerDay) {
            // Calculate statistics
            let totalEquipment = 0;
            let totalDataPoints = 0;
            
            selectedSections.forEach(sectionName => {
                const section = vfdHistory.vfd_history.sections[sectionName];
                if (section) {
                    totalEquipment += Object.keys(section).length;
                    Object.values(section).forEach(equipmentData => {
                        totalDataPoints += equipmentData.frequency_history.length;
                    });
                }
            });
            
            // Update stats display
            statSections.textContent = selectedSections.length;
            statEquipment.textContent = totalEquipment;
            statDataPoints.textContent = totalDataPoints.toLocaleString();
            
            // Generate JSON string
            const jsonString = JSON.stringify(vfdHistory, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            statFileSize.textContent = formatFileSize(blob.size);
            
            // For very large datasets, show a warning and don't display in textarea
            if (jsonString.length > 500000) { // 500KB limit for textarea
                outputTextarea.value = `// Data too large to display in textarea (${formatFileSize(blob.size)})\n// Use the download button to save the JSON file\n\n// Statistics:\n// - Sections: ${selectedSections.length}\n// - Equipment: ${totalEquipment}\n// - Data Points: ${totalDataPoints.toLocaleString()}\n// - Date Range: ${daysDiff + 1} days\n// - Data Points Per Day: ${dataPointsPerDay}`;
                showStatus(`Generated large dataset (${formatFileSize(blob.size)}). Use download button to save.`, 'warning');
            } else {
                outputTextarea.value = jsonString;
                showStatus(`Successfully generated VFD history data for ${totalEquipment} equipment across ${selectedSections.length} sections`, 'success');
            }
            
            // Show stats and enable buttons
            dataStats.style.display = 'flex';
            downloadBtn.disabled = false;
            copyBtn.disabled = false;
            progressBar.style.display = 'none';
        }

        // Show status message
        function showStatus(message, type = 'success') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // Copy to clipboard
        copyBtn.addEventListener('click', () => {
            if (!outputTextarea.value) return;
            
            outputTextarea.select();
            document.execCommand('copy');
            
            showStatus('Copied to clipboard!', 'success');
        });

        // Download JSON file
        downloadBtn.addEventListener('click', () => {
            if (!generatedData) return;
            
            const jsonString = JSON.stringify(generatedData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vfd_history_data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('File downloaded!', 'success');
        });

        // Clear all data
        clearBtn.addEventListener('click', () => {
            fileInput.value = '';
            fileInfo.classList.remove('show');
            fileName.textContent = 'No file selected';
            fileSize.textContent = '-';
            outputTextarea.value = '';
            dataStats.style.display = 'none';
            statusDiv.className = 'status';
            generateBtn.disabled = true;
            downloadBtn.disabled = true;
            copyBtn.disabled = true;
            selectAllCheckbox.disabled = true;
            sectionsContainer.innerHTML = `
                <div class="section-card" style="text-align: center; cursor: default;">
                    <p>Load a SCADA data file to see sections</p>
                </div>
            `;
            scadaData = null;
            generatedData = null;
        });
    </script>
</body>
</html>